<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>노래 추가 - Haneum</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
    <!-- 헤더 -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto max-w-4xl px-6 py-4 flex justify-between items-center">
            <a href="/" class="text-2xl font-bold text-blue-600">Haneum</a>
            <nav class="flex items-center gap-4">
                <a href="/songs" class="text-gray-600 hover:text-blue-600 transition-colors">
                    <i class="fas fa-list"></i> 전체 노래 보기
                </a>
            </nav>
        </div>
    </header>

    <main class="container mx-auto max-w-3xl px-6 py-12">
        <div class="bg-white p-8 rounded-2xl shadow-lg">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">새로운 노래 추가</h1>
            <p class="text-gray-500 mb-8">가사 번역과 언어 학습을 위해 새로운 노래를 추가합니다.</p>

            <div class="mb-6">
                <a href="https://github.com/laespero/open_haneum?tab=readme-ov-file#%EC%82%AC%EC%9A%A9-%EB%B0%A9%EB%B2%95" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 bg-green-100 hover:bg-green-200 text-green-800 text-sm font-semibold py-2 px-4 rounded-lg transition duration-300 ease-in-out">
                    <i class="fas fa-book-open"></i>
                    <span>사용 방법이 궁금하신가요?</span>
                </a>
            </div>
            
            <form action="/add" method="POST" class="space-y-6">
                <div>
                    <label for="title" class="block text-sm font-medium text-gray-700 mb-1">URL 제목 (영문, 공백 없이)</label>
                    <input type="text" id="title" name="title" required
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition">
                </div>

                <hr class="my-4 border-t border-gray-200">

                <!-- Original Names -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="ori_name" class="block text-sm font-medium text-gray-700 mb-1">노래 원어명</label>
                        <input type="text" id="ori_name" name="ori_name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                    <div>
                        <label for="artist_ori_name" class="block text-sm font-medium text-gray-700 mb-1">아티스트 원어명</label>
                        <input type="text" id="artist_ori_name" name="artist_ori_name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                </div>

                <!-- Korean Names -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="kor_name" class="block text-sm font-medium text-gray-700 mb-1">노래 한국어명</label>
                        <input type="text" id="kor_name" name="kor_name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                    <div>
                        <label for="artist_kor_name" class="block text-sm font-medium text-gray-700 mb-1">아티스트 한국어명</label>
                        <input type="text" id="artist_kor_name" name="artist_kor_name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                </div>

                <!-- English Names -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="eng_name" class="block text-sm font-medium text-gray-700 mb-1">노래 영어명</label>
                        <input type="text" id="eng_name" name="eng_name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                    <div>
                        <label for="artist_eng_name" class="block text-sm font-medium text-gray-700 mb-1">아티스트 영어명</label>
                        <input type="text" id="artist_eng_name" name="artist_eng_name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                </div>

                <hr class="my-4 border-t border-gray-200">

                <!-- Other Info -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="tags" class="block text-sm font-medium text-gray-700 mb-1">태그 (쉼표로 구분)</label>
                        <input type="text" id="tags" name="tags" placeholder="예: J-Pop, 애니메이션, 록" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                    <div>
                        <label for="vid" class="block text-sm font-medium text-gray-700 mb-1">유튜브 영상 ID (11자리) 또는 URL</label>
                        <input type="text" id="vid" name="vid" placeholder="예: CGj85pVzRJs 또는 youtube.com/watch?v=..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                </div>

                <hr class="my-4 border-t border-gray-200">

                <div>
                    <label for="text" class="block text-sm font-medium text-gray-700 mb-1">노래 가사</label>
                    <textarea id="text" name="text" required rows="10"
                              placeholder="가사를 입력하세요. 긴 문장은 줄바꿈하여 가독성을 높여주세요."
                              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition"></textarea>
                </div>

                <div class="flex justify-end pt-4">
                    <button type="submit"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 ease-in-out inline-flex items-center gap-2">
                        <i class="fas fa-save"></i> 노래 저장하기
                    </button>
                </div>
            </form>
        </div>
    </main>
    
    <footer class="text-center py-8">
        <a href="/" class="text-gray-500 hover:text-gray-700 transition">홈으로 돌아가기</a>
    </footer>

    <script>
    // URL 제목 유효성 검사 함수
    function validateTitle(title) {
        if (!title || title.trim() === '') {
            return { isValid: false, error: 'URL 제목을 입력해주세요.' };
        }
        if (title.length > 100) {
            return { isValid: false, error: 'URL 제목은 100자를 초과할 수 없습니다.' };
        }
        const validPattern = /^[a-zA-Z0-9-_]+$/;
        if (!validPattern.test(title)) {
            return { isValid: false, error: 'URL 제목은 영문, 숫자, 하이픈(-), 언더스코어(_)만 사용할 수 있습니다.' };
        }
        return { isValid: true, title: title.trim() };
    }

    // 폼 제출 시 유효성 검사
    document.querySelector('form').addEventListener('submit', function(e) {
        const titleInput = document.getElementById('title');
        const validation = validateTitle(titleInput.value);
        if (!validation.isValid) {
            e.preventDefault();
            alert(validation.error);
            titleInput.focus();
            return false;
        }
    });
    
    // 유튜브 URL에서 영상 ID 추출 로직
    document.getElementById('vid').addEventListener('input', function() {
        const url = this.value;
        let videoId = '';
        const mobileRegex = /youtu\.be\/([^\?&\/]{11})/;
        const mobileMatch = url.match(mobileRegex);
        if (mobileMatch && mobileMatch[1]) {
            videoId = mobileMatch[1];
        } else {
            const webRegex = /watch\?v=([^\?&\/]{11})/;
            const webMatch = url.match(webRegex);
            if (webMatch && webMatch[1]) {
                videoId = webMatch[1];
            } else if (url.length === 11 && /^[a-zA-Z0-9_-]+$/.test(url)) {
                videoId = url;
            }
        }
        if (videoId) {
            this.value = videoId;
            this.setCustomValidity(''); 
        } else {
            if (url.trim() !== '') {
                this.setCustomValidity('유효한 유튜브 URL 형식이 아니거나, 11자리 영상 ID를 입력해주세요.');
            } else {
                this.setCustomValidity('');
            }
        }
    });

    // 노래 원어명 입력 시 한국어/영어명 자동 완성
    document.getElementById('ori_name').addEventListener('blur', async function() {
        const oriName = this.value;
        if (!oriName) return;

        try {
            const response = await fetch('/auto-fill-names', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ori_name: oriName })
            });
            if (!response.ok) return;

            const data = await response.json();
            if (data.kor_name) document.getElementById('kor_name').value = data.kor_name;
            if (data.eng_name) document.getElementById('eng_name').value = data.eng_name;
        } catch (error) {
            console.error('자동 완성 기능 오류:', error);
        }
    });
    </script>
</body>
</html>
