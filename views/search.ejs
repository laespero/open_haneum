<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
    <% if (searchQuery && searchQuery.trim()) { %>
        "<%= searchQuery %>" 검색 결과
    <% } else { %>
        전체 노래 목록
    <% } %> - Haneum</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body class="bg-gray-100 text-gray-800 font-sans leading-relaxed flex flex-col min-h-screen">
    <%- include('partials/header') %>

    <!-- 메인 콘텐츠 -->
    <main class="container mx-auto max-w-5xl px-4 py-8 md:py-12 flex-grow">
        <!-- 검색 정보 -->
        <div class="mb-10">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-6">
                <h1 class="text-2xl md:text-4xl font-black text-gray-900 tracking-tight">
                    <% if (searchQuery && searchQuery.trim()) { %>
                        "<span class="text-blue-600"><%= searchQuery %></span>" 검색 결과
                    <% } else { %>
                        전체 탐색
                    <% } %>
                </h1>

                <div class="flex flex-wrap items-center gap-2">
                    <!-- 인기 차트 바로가기 -->
                    <a href="/popular/songs" class="inline-flex items-center px-4 py-2.5 bg-white border border-gray-100 rounded-2xl text-sm font-bold text-gray-600 hover:border-blue-300 hover:text-blue-600 transition-all shadow-sm group">
                        <i class="fas fa-fire mr-2 text-red-500 group-hover:scale-110 transition-transform"></i>
                        인기 노래
                    </a>
                    <a href="/popular/artists" class="inline-flex items-center px-4 py-2.5 bg-white border border-gray-100 rounded-2xl text-sm font-bold text-gray-600 hover:border-purple-300 hover:text-purple-600 transition-all shadow-sm group">
                        <i class="fas fa-crown mr-2 text-yellow-500 group-hover:scale-110 transition-transform"></i>
                        인기 아티스트
                    </a>
                </div>
            </div>
            
            <!-- 검색 타입 탭 -->
            <div class="flex items-center gap-1 bg-gray-50 p-1 rounded-2xl w-fit border border-gray-100 mb-8">
                <a href="/songs?q=<%= encodeURIComponent(searchQuery) %>&type=songs&sort=<%= currentSort %>" 
                   class="px-6 py-2.5 rounded-xl text-sm font-bold transition-all flex items-center gap-2 <%= currentType === 'songs' ? 'bg-white text-blue-600 shadow-sm border border-gray-100' : 'text-gray-400 hover:text-gray-600' %>">
                    <i class="fas fa-music text-[10px]"></i>
                    노래
                    <span class="text-[10px] bg-blue-50 text-blue-600 px-1.5 py-0.5 rounded-full"><%= songsCount %></span>
                </a>
                <a href="/songs?q=<%= encodeURIComponent(searchQuery) %>&type=playlists&sort=<%= currentSort %>" 
                   class="px-6 py-2.5 rounded-xl text-sm font-bold transition-all flex items-center gap-2 <%= currentType === 'playlists' ? 'bg-white text-purple-600 shadow-sm border border-gray-100' : 'text-gray-400 hover:text-gray-600' %>">
                    <i class="fas fa-list-ul text-[10px]"></i>
                    플레이리스트
                    <span class="text-[10px] bg-purple-50 text-purple-600 px-1.5 py-0.5 rounded-full"><%= playlistsCount %></span>
                </a>
            </div>

            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <p class="text-gray-500 text-sm font-medium">
                    총 <span class="font-bold text-gray-900"><%= currentType === 'songs' ? songsCount : playlistsCount %></span>개의 결과
                </p>
                
                <div class="flex flex-wrap items-center gap-2">
                    <% if (currentType === 'songs') { %>
                    <div class="flex items-center gap-2 bg-white px-3 py-1.5 rounded-xl border border-gray-100 shadow-sm ml-0 md:ml-2">
                        <a href="/songs?q=<%= encodeURIComponent(searchQuery) %>&type=songs&sort=popular" 
                           class="<%= currentSort === 'popular' ? 'text-blue-600 font-bold' : 'text-gray-400 hover:text-gray-600' %> transition-colors">
                            인기순
                        </a>
                        <span class="text-gray-200">·</span>
                        <a href="/songs?q=<%= encodeURIComponent(searchQuery) %>&type=songs&sort=latest" 
                           class="<%= currentSort === 'latest' ? 'text-blue-600 font-bold' : 'text-gray-400 hover:text-gray-600' %> transition-colors">
                            최신순
                        </a>
                    </div>
                    <% } %>
                </div>
            </div>
        </div>

        <% if (results.length === 0) { %>
            <!-- 결과가 없을 때 -->
            <div class="text-center py-16 md:py-24 bg-white rounded-[3rem] border border-gray-100 shadow-sm px-6">
                <div class="w-20 h-20 bg-gray-50 text-gray-300 rounded-3xl flex items-center justify-center text-3xl mx-auto mb-6">
                    <i class="fas fa-search"></i>
                </div>
                <h3 class="text-xl md:text-2xl font-black text-gray-900 mb-3">
                    <% if (searchQuery && searchQuery.trim()) { %>
                        "<span class="text-blue-600"><%= searchQuery %></span>"에 대한 결과를 찾을 수 없습니다
                    <% } else { %>
                        등록된 데이터가 없습니다
                    <% } %>
                </h3>
                <p class="text-gray-500 mb-10 font-medium leading-relaxed">
                    찾으시는 <%= currentType === 'songs' ? '노래가' : '플레이리스트가' %> 없나요?<br class="hidden sm:block">
                    <% if (currentType === 'songs') { %>
                        직접 노래를 추가해서 Haneum 커뮤니티에 기여해보세요!
                    <% } else { %>
                        나만의 플레이리스트를 직접 만들어보세요!
                    <% } %>
                </p>
                
                <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
                    <% if (currentType === 'songs') { %>
                        <a href="/add-song" class="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-8 py-4 bg-blue-600 text-white rounded-2xl font-bold hover:bg-blue-700 transition-all shadow-lg shadow-blue-200">
                            <i class="fas fa-plus"></i>
                            노래 추가하기
                        </a>
                        <a href="/songs?type=songs" class="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-8 py-4 bg-gray-100 text-gray-600 rounded-2xl font-bold hover:bg-gray-200 transition-all">
                            <i class="fas fa-list"></i>
                            전체 노래 탐색
                        </a>
                    <% } else { %>
                        <a href="/playlists" class="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-8 py-4 bg-purple-600 text-white rounded-2xl font-bold hover:bg-purple-700 transition-all shadow-lg shadow-purple-200">
                            <i class="fas fa-plus"></i>
                            플레이리스트 만들기
                        </a>
                        <a href="/songs?type=playlists" class="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-8 py-4 bg-gray-100 text-gray-600 rounded-2xl font-bold hover:bg-gray-200 transition-all">
                            <i class="fas fa-list"></i>
                            전체 플레이리스트 탐색
                        </a>
                    <% } %>
                </div>

                <% if (searchQuery && searchQuery.trim()) { %>
                <div class="mt-12 p-6 bg-blue-50/50 rounded-[2rem] text-left max-w-lg mx-auto">
                    <h4 class="font-bold text-blue-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-lightbulb"></i>
                        검색 팁
                    </h4>
                    <ul class="text-sm text-blue-700 space-y-2 font-medium">
                        <li class="flex items-start gap-2">
                            <span class="text-blue-400">•</span>
                            <span>아티스트 이름이나 다른 언어 제목으로 검색해 보세요.</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-blue-400">•</span>
                            <span>검색어가 정확한지 확인해 보세요.</span>
                        </li>
                    </ul>
                </div>
                <% } %>
            </div>
        <% } else { %>
            <% if (currentType === 'playlists') { %>
                <!-- 플레이리스트 결과 그리드 -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <% results.forEach(pl => { %>
                        <a href="/playlists/<%= pl.id %>" class="group block bg-white rounded-3xl p-6 border border-gray-100 hover:shadow-xl hover:shadow-purple-500/5 transition-all duration-300 transform hover:-translate-y-1">
                            <div class="flex items-start justify-between mb-6">
                                <div class="w-12 h-12 bg-purple-50 text-purple-600 rounded-2xl flex items-center justify-center text-xl group-hover:scale-110 transition-transform duration-500">
                                    <i class="fas fa-list-ul"></i>
                                </div>
                                <% if (!pl.is_public) { %>
                                    <span class="px-2.5 py-1 bg-gray-50 text-gray-400 text-[10px] font-bold uppercase tracking-wider rounded-lg border border-gray-100">Private</span>
                                <% } %>
                            </div>
                            <h3 class="text-lg font-black text-gray-900 mb-2 group-hover:text-purple-600 transition-colors line-clamp-1"><%= pl.name %></h3>
                            <p class="text-gray-500 text-sm font-medium line-clamp-2 mb-6 h-10">
                                <%= pl.description || '특별한 설명이 없는 리스트입니다.' %>
                            </p>
                            <div class="flex items-center justify-between pt-6 border-t border-gray-50 mt-auto">
                                <div class="flex items-center gap-3 text-[10px] font-bold text-gray-400 uppercase tracking-widest">
                                    <span class="flex items-center gap-1.5">
                                        <i class="fas fa-user-circle"></i>
                                        <%= pl.owner_name %>
                                    </span>
                                    <span class="flex items-center gap-1.5">
                                        <i class="fas fa-music"></i>
                                        <%= pl.song_count %>곡
                                    </span>
                                </div>
                                <div class="w-8 h-8 rounded-full bg-purple-50 text-purple-600 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity transform translate-x-2 group-hover:translate-x-0">
                                    <i class="fas fa-arrow-right text-sm"></i>
                                </div>
                            </div>
                        </a>
                    <% }) %>
                </div>
            <% } else { %>
                <!-- 노래 결과 목록 -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <% results.forEach(song => { %>
                        <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-gray-100 hover:shadow-xl hover:shadow-blue-500/5 transition-all duration-300 transform hover:-translate-y-0.5 cursor-pointer group" onclick="location.href='/songs/<%= encodeURIComponent(song.name) %>'">
                            <div class="flex justify-between items-start gap-4">
                                <div class="flex-grow min-w-0">
                                    <div class="mb-1">
                                        <% if (song.kor_name) { %>
                                            <span class="text-xs font-bold text-blue-600"><%= song.kor_name %></span>
                                        <% } %>
                                    </div>
                                    <h2 class="text-xl font-black text-gray-900 group-hover:text-blue-600 transition-colors leading-tight mb-2 truncate">
                                        <%= song.ori_name || song.name %>
                                    </h2>
                                    
                                    <div class="flex flex-wrap items-center gap-4">
                                        <% 
                                        let artistDisplayName;
                                        let artistSearchQuery;
                                        if (typeof song.artist === 'object' && song.artist) {
                                            artistDisplayName = song.artist.kor_name || song.artist.eng_name || song.artist.ori_name;
                                            artistSearchQuery = song.artist.ori_name || song.artist.kor_name;
                                        } else {
                                            artistDisplayName = song.artist;
                                            artistSearchQuery = song.artist;
                                        }
                                        %>
                                        <div class="flex items-center gap-2">
                                            <div class="w-6 h-6 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center text-[10px]">
                                                <i class="fas fa-music"></i>
                                            </div>
                                            <a href="/songs?q=<%= encodeURIComponent(artistSearchQuery) %>" onclick="event.stopPropagation()" class="text-sm font-bold text-gray-600 hover:text-blue-600 transition-colors truncate max-w-[150px]"><%= artistDisplayName %></a>
                                        </div>

                                        <% if (song.createdAt) { %>
                                            <div class="flex items-center gap-1.5 text-[10px] font-bold text-gray-400 uppercase tracking-widest">
                                                <i class="far fa-calendar-alt"></i>
                                                <%= new Date(song.createdAt).toLocaleDateString('ko-KR', {
                                                    year: 'numeric',
                                                    month: '2-digit',
                                                    day: '2-digit'
                                                }) %>
                                            </div>
                                        <% } %>
                                    </div>
                                </div>
                                <div class="w-12 h-12 rounded-2xl bg-blue-50 text-blue-600 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all shadow-sm">
                                    <i class="fas fa-play text-sm"></i>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>
            <% } %>

            <!-- 페이지네이션 -->
            <% if (totalPages > 1) { %>
                <div class="mt-16 flex justify-center items-center gap-2">
                    <% if (currentPage > 1) { %>
                        <a href="/songs?q=<%= encodeURIComponent(searchQuery) %>&type=<%= currentType %>&sort=<%= currentSort %>&page=1" 
                           class="px-4 py-2 bg-white border border-gray-100 rounded-xl text-sm font-bold text-gray-500 hover:border-blue-300 hover:text-blue-600 transition-all shadow-sm">
                            처음
                        </a>
                    <% } %>
                    
                    <% 
                    let startPage = Math.max(1, currentPage - 2);
                    let endPage = Math.min(totalPages, startPage + 4);
                    if (endPage - startPage < 4) startPage = Math.max(1, endPage - 4);
                    
                    for (let i = startPage; i <= endPage; i++) { 
                        if (i < 1) continue;
                    %>
                        <a href="/songs?q=<%= encodeURIComponent(searchQuery) %>&type=<%= currentType %>&sort=<%= currentSort %>&page=<%= i %>" 
                           class="w-10 h-10 flex items-center justify-center rounded-xl border transition-all font-bold <%= i === currentPage ? 'bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200' : 'bg-white border-gray-100 text-gray-500 hover:border-blue-300 hover:text-blue-600' %>">
                            <%= i %>
                        </a>
                    <% } %>

                    <% if (currentPage < totalPages) { %>
                        <a href="/songs?q=<%= encodeURIComponent(searchQuery) %>&type=<%= currentType %>&sort=<%= currentSort %>&page=<%= totalPages %>" 
                           class="px-4 py-2 bg-white border border-gray-100 rounded-xl text-sm font-bold text-gray-500 hover:border-blue-300 hover:text-blue-600 transition-all shadow-sm">
                            마지막
                        </a>
                    <% } %>
                </div>
            <% } %>
        <% } %>
    </main>

    <%- include('partials/footer') %>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchForm = document.getElementById('searchForm');
            const searchInput = document.getElementById('searchInput');

            if (searchForm && searchInput) {
                searchForm.addEventListener('submit', () => {
                    searchInput.value = searchInput.value.trim();
                });
            }
        });
    </script>
</body>
</html> 
