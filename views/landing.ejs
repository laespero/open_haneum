<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오픈 한음(Open Haneum)</title>
    <meta name="description" content="오픈 한음은 AI를 활용하여 노래 가사의 번역, 발음, 단어, 문법을 분석하여 외국어 학습을 돕는 웹 애플리케이션입니다.">
    <meta name="keywords" content="가사 분석, 외국어 학습, 단어장, AI, 일본어, 중국어, 영어, 한자, 발음, 노래 번역, 노래 가사, 노래 발음, 노래 단어">
    <meta name="naver-site-verification" content="3d8f3a813eb3c5fed2eee7ed101ca90d98c30ae5" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
    <script>
        window.onload = function() {
            if(location.hostname != "localhost") {
                if (window.location.protocol != "https:") {
                    window.location.href = "https:" + window.location.href.substring(window.location.protocol.length);
                }

                if (document.location.protocol == 'http:') {
                    document.location.href = document.location.href.replace('http:', 'https:');
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body class="bg-gray-100 text-gray-800 font-sans leading-relaxed">
    <!-- 헤더 -->
    <header id="hero" class="text-white text-center py-24 md:py-32 px-6 bg-gradient-to-r from-blue-600 to-indigo-600">
        <div class="container mx-auto max-w-4xl">
            <h1 class="text-4xl md:text-5xl font-bold mb-4 leading-tight">Haneum과 함께 어떤 외국어든 노래로 즐겁게 공부하세요.</h1>
            <form action="/songs" method="get" class="flex flex-col sm:flex-row justify-center max-w-xl mx-auto">
                <input type="search" name="q" placeholder="노래 제목 또는 아티스트를 입력하세요"
                       class="flex-grow px-5 py-4 rounded-full sm:rounded-r-none text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2 sm:mb-0 text-lg">
                <button type="submit"
                        class="bg-white text-blue-600 font-semibold px-8 py-4 rounded-full sm:rounded-l-none transition duration-300 ease-in-out text-lg inline-flex items-center justify-center gap-2">
                    <i class="fas fa-search"></i> 노래 찾기
                </button>
            </form>
            <div class="flex justify-center gap-4 mt-6">
                <a href="/add-song" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold px-6 py-3 rounded-full transition duration-300 ease-in-out text-lg inline-flex items-center justify-center gap-2">
                    <i class="fas fa-plus"></i> 노래 추가하기
                </a>
                <a href="/songs" class="bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-6 py-3 rounded-full transition duration-300 ease-in-out text-lg inline-flex items-center justify-center gap-2">
                    <i class="fas fa-list"></i> 전체 노래 보기
                </a>
            </div>
        </div>
    </header>

    <main>
        <!-- 주요 특징 섹션 -->
        <!-- <section class="bg-white py-16 px-6">
            <div class="container mx-auto max-w-6xl">
                <h2 class="text-3xl font-semibold text-center mb-12">Haneum만의 특별함</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-10 text-center">
                   
                    <div class="feature-item p-4">
                        <i class="fas fa-mobile-alt text-4xl text-blue-600 mb-4"></i>
                        <h3 class="text-xl font-semibold mb-2">편리한 사용성</h3>
                        <p class="text-gray-600">PC/모바일 어디서든 최적화된 화면, 직관적인 디자인</p>
                    </div>
                    <div class="feature-item p-4">
                        <i class="fas fa-language text-4xl text-blue-600 mb-4"></i>
                        <h3 class="text-xl font-semibold mb-2">다국어 지원</h3>
                        <p class="text-gray-600">한국어, 영어, 일본어 등 다양한 언어의 가사 제공</p>
                    </div>
                </div>
            </div>
        </section> -->

        <!-- 메인 컨텐츠 그리드 -->
        <section class="py-16 px-6">
            <div class="container mx-auto max-w-7xl">
                <!-- 로딩 인디케이터 -->
                <div id="loading" class="hidden text-center py-16">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                    <p class="mt-4 text-gray-600">데이터를 불러오는 중...</p>
                </div>
                
                <!-- 언어 필터 -->
                <div class="mb-8">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                                <i class="fas fa-filter text-blue-600 mr-2"></i>
                                언어별 필터
                            </h3>
                            <div class="text-xs text-gray-500">
                                원하는 언어를 선택하세요
                            </div>
                        </div>
                        <div class="flex justify-start flex-wrap gap-3">
                            <button onclick="filterByLanguage('all')" 
                                    class="language-filter <%= (currentLanguage || 'all') === 'all' ? 'active bg-blue-600 text-white hover:bg-blue-700' : 'bg-gray-100 hover:bg-blue-600 text-gray-700 hover:text-white' %> font-semibold px-5 py-2.5 rounded-full transition duration-300 ease-in-out text-sm shadow-sm">
                                전체
                            </button>
                            <button onclick="filterByLanguage('english')" 
                                    class="language-filter <%= (currentLanguage || 'all') === 'english' ? 'active bg-blue-600 text-white hover:bg-blue-700' : 'bg-gray-100 hover:bg-blue-600 text-gray-700 hover:text-white' %> font-semibold px-5 py-2.5 rounded-full transition duration-300 ease-in-out text-sm shadow-sm">
                                영어
                            </button>
                            <button onclick="filterByLanguage('japanese')" 
                                    class="language-filter <%= (currentLanguage || 'all') === 'japanese' ? 'active bg-blue-600 text-white hover:bg-blue-700' : 'bg-gray-100 hover:bg-blue-600 text-gray-700 hover:text-white' %> font-semibold px-5 py-2.5 rounded-full transition duration-300 ease-in-out text-sm shadow-sm">
                                일본어
                            </button>
                            <button onclick="filterByLanguage('chinese')" 
                                    class="language-filter <%= (currentLanguage || 'all') === 'chinese' ? 'active bg-blue-600 text-white hover:bg-blue-700' : 'bg-gray-100 hover:bg-blue-600 text-gray-700 hover:text-white' %> font-semibold px-5 py-2.5 rounded-full transition duration-300 ease-in-out text-sm shadow-sm">
                                중국어
                            </button>
                            <button onclick="filterByLanguage('other')" 
                                    class="language-filter <%= (currentLanguage || 'all') === 'other' ? 'active bg-blue-600 text-white hover:bg-blue-700' : 'bg-gray-100 hover:bg-blue-600 text-gray-700 hover:text-white' %> font-semibold px-5 py-2.5 rounded-full transition duration-300 ease-in-out text-sm shadow-sm">
                                기타
                            </button>
                        </div>
                    </div>
                </div>

                <div id="main-content" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    
                    <!-- 최근 추가된 노래 (메인 컬럼) -->
                    <div class="lg:col-span-2">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                                <i class="fas fa-clock text-blue-600 mr-3"></i>
                                최근 추가된 노래
                            </h2>
                            <a href="javascript:void(0)" onclick="goToSongsPage()" class="text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center cursor-pointer">
                                더보기 <i class="fas fa-arrow-right ml-1"></i>
                            </a>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <% latestSongs.slice(0, 16).forEach(song => { %>
                                <div class="group bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 hover:border-blue-200 hover:-translate-y-1">
                                    <div class="p-6">
                                        <a href="/songs/<%= song.name %>" class="block">
                                            <div class="flex items-start justify-between mb-3">
                                                <div class="flex-1">
                                                    <h3 class="font-bold text-lg text-gray-800 group-hover:text-blue-600 transition-colors line-clamp-2 leading-tight">
                                                        <%= song.ori_name || song.name %>
                                                    </h3>
                                                </div>
                                                <div class="flex-shrink-0 ml-3">
                                                    <div class="w-2 h-2 bg-blue-400 rounded-full opacity-60 group-hover:opacity-100 group-hover:scale-150 transition-all duration-300"></div>
                                                </div>
                                            </div>
                                            
                                            <div class="space-y-2">
                                                <p class="text-sm text-blue-600 font-medium">
                                                    <%= song.kor_name %>
                                                </p>
                                            </div>
                                        </a>
                                        
                                        <div class="mt-2">
                                            <div class="flex items-center space-x-2">
                                                <div class="w-6 h-6 rounded-full bg-gradient-to-r from-blue-500 to-indigo-500 flex items-center justify-center">
                                                    <i class="fas fa-music text-white text-xs"></i>
                                                </div>
                                                <a href="/songs?q=<%= encodeURIComponent(typeof song.artist === 'object' ? (song.artist.kor_name || song.artist.eng_name || song.artist.ori_name) : song.artist) %>" 
                                                   class="text-sm text-gray-600 font-medium hover:text-blue-600 transition-colors cursor-pointer">
                                                    <%= typeof song.artist === 'object' ? (song.artist.kor_name || song.artist.eng_name || song.artist.ori_name) : song.artist %>
                                                </a>
                                            </div>
                                        </div>
                                        
                                        <a href="/songs/<%= song.name %>">
                                            <div class="mt-4 pt-3 border-t border-gray-100">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex items-center space-x-1 text-xs text-gray-400">
                                                        <i class="fas fa-clock"></i>
                                                        <span>
                                                            <% if (song.createdAt) { %>
                                                                <%= new Date(song.createdAt).toLocaleDateString('ko-KR', {
                                                                    month: 'short',
                                                                    day: 'numeric'
                                                                }) %>
                                                            <% } else { %>
                                                                최근
                                                            <% } %>
                                                        </span>
                                                    </div>
                                                    <div class="flex items-center space-x-1 text-xs text-blue-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                                        <span>학습하기</span>
                                                        <i class="fas fa-arrow-right"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                    </div>

                    <!-- 사이드바 (인기 노래 + 인기 아티스트) -->
                    <div class="space-y-8">
                        
                        <!-- 인기 노래 섹션 -->
                        <div class="bg-gradient-to-br from-orange-50 to-red-50 rounded-xl p-6 border border-orange-100">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-xl font-bold text-gray-800 flex items-center">
                                    <i class="fas fa-fire text-orange-500 mr-2"></i>
                                    인기 노래
                                </h2>
                                <% if (popularSongs && popularSongs.length > 0) { %>
                                    <a href="javascript:void(0)" onclick="goToPopularSongsPage()" class="text-orange-600 hover:text-orange-700 text-sm font-medium flex items-center cursor-pointer">
                                        더보기 <i class="fas fa-arrow-right ml-1"></i>
                                    </a>
                                <% } %>
                            </div>
                            <% if (popularSongs && popularSongs.length > 0) { %>
                                <div class="space-y-3">
                                    <% popularSongs.slice(0, 10).forEach((song, index) => { %>
                                        <div class="flex items-center space-x-3 p-3 bg-white rounded-lg hover:shadow-md transition-shadow duration-200">
                                            <div class="flex-shrink-0 w-6 h-6 rounded-full bg-gradient-to-r from-orange-400 to-red-400 flex items-center justify-center text-white text-xs font-bold">
                                                <%= index + 1 %>
                                            </div>
                                            <div class="flex-1 min-w-0">
                                                <a href="/songs/<%= song.name %>" class="block hover:text-orange-600 transition-colors">
                                                    <p class="font-medium text-gray-800 truncate">
                                                        <%= song.ori_name || song.name %>
                                                    </p>
                                                    <p class="text-xs text-gray-500 truncate">
                                                        <%= typeof song.artist === 'object' ? (song.artist.kor_name || song.artist.eng_name || song.artist.ori_name) : song.artist %>
                                                    </p>
                                                </a>
                                            </div>
                                            <div class="flex-shrink-0 text-xs text-orange-600 font-medium flex items-center">
                                                <i class="fas fa-eye mr-1"></i>
                                                <%= song.views.toLocaleString() %>
                                            </div>
                                        </div>
                                    <% }); %>
                                </div>
                            <% } else { %>
                                <div class="text-center py-8 text-gray-500">
                                    <i class="fas fa-music text-4xl mb-3 opacity-50"></i>
                                    <p>아직 조회 데이터가 없습니다.</p>
                                    <p class="text-sm">노래를 듣고 인기 차트를 만들어보세요!</p>
                                </div>
                            <% } %>
                        </div>

                        <!-- 인기 아티스트 섹션 -->
                        <div class="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl p-6 border border-purple-100">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-xl font-bold text-gray-800 flex items-center">
                                    <i class="fas fa-star text-purple-500 mr-2"></i>
                                    인기 아티스트
                                </h2>
                                <% if (popularArtists && popularArtists.length > 0) { %>
                                    <a href="javascript:void(0)" onclick="goToPopularArtistsPage()" class="text-purple-600 hover:text-purple-700 text-sm font-medium flex items-center cursor-pointer">
                                        더보기 <i class="fas fa-arrow-right ml-1"></i>
                                    </a>
                                <% } %>
                            </div>
                            <% if (popularArtists && popularArtists.length > 0) { %>
                                <div class="space-y-3">
                                    <% popularArtists.slice(0, 10).forEach((artist, index) => { %>
                                        <a href="/songs?q=<%= encodeURIComponent(artist.name) %>" class="block">
                                            <div class="flex items-center space-x-3 p-4 bg-white rounded-lg hover:shadow-lg hover:scale-105 transition-all duration-200 cursor-pointer group">
                                                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-r from-purple-400 to-indigo-400 flex items-center justify-center text-white text-sm font-bold group-hover:from-purple-500 group-hover:to-indigo-500 transition-colors">
                                                    <%= index + 1 %>
                                                </div>
                                                <div class="flex-1 min-w-0">
                                                    <p class="font-medium text-gray-800 truncate group-hover:text-purple-600 transition-colors">
                                                        <%= artist.name %>
                                                    </p>
                                                    <p class="text-xs text-gray-500 group-hover:text-gray-600 transition-colors">
                                                        <%= artist.songs.length %>곡 • <i class="fas fa-eye"></i> <%= artist.totalViews.toLocaleString() %>
                                                    </p>
                                                </div>
                                            </div>
                                        </a>
                                    <% }); %>
                                </div>
                            <% } else { %>
                                <div class="text-center py-8 text-gray-500">
                                    <div class="text-6xl mb-3 opacity-50">🎭</div>
                                    <p>아직 아티스트 데이터가 없습니다.</p>
                                    <p class="text-sm">노래를 듣고 인기 아티스트를 확인해보세요!</p>
                                </div>
                            <% } %>
                        </div>

                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 푸터 -->
    <footer class="bg-gray-800 text-gray-400 py-12 px-6 text-center">
        <div class="container mx-auto max-w-6xl">
            <!-- <nav class="mb-6">
                <ul class="flex flex-wrap justify-center gap-x-6 gap-y-2">
                    <li><a href="/about" class="hover:text-white transition duration-200">About Haneum</a></li>
                    <li><a href="/contact" class="hover:text-white transition duration-200">문의하기</a></li>
                    <li><a href="/privacy" class="hover:text-white transition duration-200">개인정보처리방침</a></li>
                    <li><a href="/terms" class="hover:text-white transition duration-200">이용약관</a></li>
                    <li><a href="/copyright" class="hover:text-white transition duration-200">저작권 안내</a></li>
                </ul>
            </nav> -->
            <p class="notice text-xs text-gray-500 mt-2 max-w-xl mx-auto">본 사이트의 가사 정보는 교육 및 비상업적 용도로 제공되며, 저작권은 해당 저작권자에게 있습니다.</p>
        </div>
    </footer>

    <script>
        // 쿠키 유틸리티 함수들
        function setCookie(name, value, days = 30) {
            const expires = new Date();
            expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = name + '=' + value + ';expires=' + expires.toUTCString() + ';path=/';
        }
        
        function getCookie(name) {
            const nameEQ = name + '=';
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        // URL 파라미터, 쿠키, 기본값 순으로 언어 설정 결정
        function getInitialLanguage() {
            const urlParams = new URLSearchParams(window.location.search);
            const urlLanguage = urlParams.get('language');
            const cookieLanguage = getCookie('preferredLanguage');
            
            return urlLanguage || cookieLanguage || 'all';
        }
        
        let currentLanguage = getInitialLanguage();
        
        // 서버에서 렌더링된 언어 (서버에서 이미 필터링된 상태)
        const serverLanguage = '<%= currentLanguage || "all" %>';

        // 언어별 검색 쿼리 매핑
        function getLanguageQuery(language) {
            const languageMap = {
                'english': '영어',
                'japanese': '일본어',
                'chinese': '중국어',
                'other': '', // 기타는 특별한 쿼리 없이 전체에서 영어/일본어/중국어 제외
                'all': ''
            };
            return languageMap[language] || '';
        }

        // 더보기 버튼 클릭 처리 (쿠키 기반)
        function goToSongsPage() {
            const savedLanguage = getCookie('preferredLanguage') || 'all';
            const query = getLanguageQuery(savedLanguage);
            if (query) {
                window.location.href = `/songs?q=${encodeURIComponent(query)}`;
            } else {
                window.location.href = '/songs';
            }
        }

        // 인기 노래 더보기 버튼 클릭 처리 (쿠키 기반)
        function goToPopularSongsPage() {
            const savedLanguage = getCookie('preferredLanguage') || 'all';
            if (savedLanguage !== 'all') {
                window.location.href = `/popular/songs?language=${savedLanguage}`;
            } else {
                window.location.href = '/popular/songs';
            }
        }

        // 인기 아티스트 더보기 버튼 클릭 처리 (쿠키 기반)
        function goToPopularArtistsPage() {
            const savedLanguage = getCookie('preferredLanguage') || 'all';
            if (savedLanguage !== 'all') {
                window.location.href = `/popular/artists?language=${savedLanguage}`;
            } else {
                window.location.href = '/popular/artists';
            }
        }

        // URL 업데이트 함수
        function updateURL(language) {
            const url = new URL(window.location);
            if (language === 'all') {
                url.searchParams.delete('language');
            } else {
                url.searchParams.set('language', language);
            }
            
            // URL 업데이트 (페이지 리로드 없이)
            window.history.replaceState({language: language}, '', url.toString());
        }

        // 언어 필터링 함수
        async function filterByLanguage(language) {
            if (currentLanguage === language) return;
            
            currentLanguage = language;
            
            // 쿠키에 언어 설정 저장
            setCookie('preferredLanguage', language);
            
            // URL 업데이트
            updateURL(language);
            
            // 버튼 상태 업데이트
            updateFilterButtons(language);
            
            // 로딩 표시
            showLoading();
            
            try {
                // API 호출
                const response = await fetch(`/api/filter?language=${language}`);
                const data = await response.json();
                
                // 콘텐츠 업데이트
                updateMainContent(data);
                
            } catch (error) {
                console.error('필터링 중 오류:', error);
                alert('필터링 중 오류가 발생했습니다.');
            } finally {
                hideLoading();
            }
        }

        // 필터 버튼 상태 업데이트
        function updateFilterButtons(activeLanguage) {
            const buttons = document.querySelectorAll('.language-filter');
            buttons.forEach(button => {
                button.classList.remove('active', 'bg-blue-600', 'text-white', 'hover:bg-blue-700');
                button.classList.add('bg-gray-100', 'hover:bg-blue-600', 'text-gray-700', 'hover:text-white');
            });
            
            const activeButton = document.querySelector(`[onclick="filterByLanguage('${activeLanguage}')"]`);
            if (activeButton) {
                activeButton.classList.remove('bg-gray-100', 'hover:bg-blue-600', 'text-gray-700', 'hover:text-white');
                activeButton.classList.add('active', 'bg-blue-600', 'text-white', 'hover:bg-blue-700');
            }
        }

        // 로딩 표시/숨김
        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('main-content').style.opacity = '0.5';
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('main-content').style.opacity = '1';
        }

        // 브라우저 뒤로/앞으로 가기 처리
        window.addEventListener('popstate', function(event) {
            const newLanguage = getInitialLanguage();
            if (newLanguage !== currentLanguage) {
                currentLanguage = newLanguage;
                setCookie('preferredLanguage', newLanguage);
                updateFilterButtons(newLanguage);
                
                if (newLanguage !== 'all') {
                    filterByLanguage(newLanguage);
                } else {
                    // 전체로 돌아갈 때는 페이지 새로고침
                    window.location.reload();
                }
            }
        });

        // 페이지 로드 시 초기화
        window.addEventListener('DOMContentLoaded', function() {
            // 쿠키에서 불러온 언어 설정으로 필터 버튼 상태 설정
            updateFilterButtons(currentLanguage);
            
            // 서버에서 이미 올바른 언어로 렌더링된 경우 AJAX 호출 안함
            if (currentLanguage !== serverLanguage) {
                console.log(`언어 불일치 감지: 클라이언트(${currentLanguage}) vs 서버(${serverLanguage}) - AJAX 호출`);
                filterByLanguage(currentLanguage);
            } else if (currentLanguage !== 'all') {
                // 서버와 클라이언트 언어가 같고, 'all'이 아닌 경우 URL만 업데이트
                console.log(`언어 일치: ${currentLanguage} - URL만 업데이트`);
                updateURL(currentLanguage);
            }
        });

        // 메인 콘텐츠 업데이트
        function updateMainContent(data) {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <!-- 최근 추가된 노래 (메인 컬럼) -->
                <div class="lg:col-span-2">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                            <i class="fas fa-clock text-blue-600 mr-3"></i>
                            최근 추가된 노래
                        </h2>
                        <a href="javascript:void(0)" onclick="goToSongsPage()" class="text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center cursor-pointer">
                            더보기 <i class="fas fa-arrow-right ml-1"></i>
                        </a>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        ${data.latestSongs.map(song => `
                            <div class="group bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 hover:border-blue-200 hover:-translate-y-1">
                                <div class="p-6">
                                    <a href="/songs/${song.name}" class="block">
                                        <div class="flex items-start justify-between mb-3">
                                            <div class="flex-1">
                                                <h3 class="font-bold text-lg text-gray-800 group-hover:text-blue-600 transition-colors line-clamp-2 leading-tight">
                                                    ${song.ori_name || song.name}
                                                </h3>
                                            </div>
                                            <div class="flex-shrink-0 ml-3">
                                                <div class="w-2 h-2 bg-blue-400 rounded-full opacity-60 group-hover:opacity-100 group-hover:scale-150 transition-all duration-300"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="space-y-2">
                                            <p class="text-sm text-blue-600 font-medium">
                                                ${song.kor_name || ''}
                                            </p>
                                        </div>
                                    </a>
                                    
                                    <div class="mt-2">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-6 h-6 rounded-full bg-gradient-to-r from-blue-500 to-indigo-500 flex items-center justify-center">
                                                <i class="fas fa-music text-white text-xs"></i>
                                            </div>
                                            <a href="/songs?q=${encodeURIComponent(typeof song.artist === 'object' ? (song.artist.kor_name || song.artist.eng_name || song.artist.ori_name) : song.artist)}" 
                                               class="text-sm text-gray-600 font-medium hover:text-blue-600 transition-colors cursor-pointer">
                                                ${typeof song.artist === 'object' ? (song.artist.kor_name || song.artist.eng_name || song.artist.ori_name) : song.artist}
                                            </a>
                                        </div>
                                    </div>
                                    
                                    <a href="/songs/${song.name}">
                                        <div class="mt-4 pt-3 border-t border-gray-100">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center space-x-1 text-xs text-gray-400">
                                                    <i class="fas fa-clock"></i>
                                                    <span>
                                                        ${song.createdAt ? new Date(song.createdAt).toLocaleDateString('ko-KR', {month: 'short', day: 'numeric'}) : '최근'}
                                                    </span>
                                                </div>
                                                <div class="flex items-center space-x-1 text-xs text-blue-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                                    <span>학습하기</span>
                                                    <i class="fas fa-arrow-right"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- 사이드바 (인기 노래 + 인기 아티스트) -->
                <div class="space-y-8">
                    <!-- 인기 노래 섹션 -->
                    <div class="bg-gradient-to-br from-orange-50 to-red-50 rounded-xl p-6 border border-orange-100">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold text-gray-800 flex items-center">
                                <i class="fas fa-fire text-orange-500 mr-2"></i>
                                인기 노래
                            </h2>
                            ${data.popularSongs.length > 0 ? `
                                <a href="javascript:void(0)" onclick="goToPopularSongsPage()" class="text-orange-600 hover:text-orange-700 text-sm font-medium flex items-center cursor-pointer">
                                    더보기 <i class="fas fa-arrow-right ml-1"></i>
                                </a>
                            ` : ''}
                        </div>
                        ${data.popularSongs.length > 0 ? `
                            <div class="space-y-3">
                                ${data.popularSongs.slice(0, 10).map((song, index) => `
                                    <div class="flex items-center space-x-3 p-3 bg-white rounded-lg hover:shadow-md transition-shadow duration-200">
                                        <div class="flex-shrink-0 w-6 h-6 rounded-full bg-gradient-to-r from-orange-400 to-red-400 flex items-center justify-center text-white text-xs font-bold">
                                            ${index + 1}
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <a href="/songs/${song.name}" class="block hover:text-orange-600 transition-colors">
                                                <p class="font-medium text-gray-800 truncate">
                                                    ${song.ori_name || song.name}
                                                </p>
                                                <p class="text-xs text-gray-500 truncate">
                                                    ${typeof song.artist === 'object' ? (song.artist.kor_name || song.artist.eng_name || song.artist.ori_name) : song.artist}
                                                </p>
                                            </a>
                                        </div>
                                        <div class="flex-shrink-0 text-xs text-orange-600 font-medium flex items-center">
                                            <i class="fas fa-eye mr-1"></i>
                                            ${song.views.toLocaleString()}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="text-center py-8 text-gray-500">
                                <i class="fas fa-music text-4xl mb-3 opacity-50"></i>
                                <p>아직 조회 데이터가 없습니다.</p>
                                <p class="text-sm">노래를 듣고 인기 차트를 만들어보세요!</p>
                            </div>
                        `}
                    </div>

                    <!-- 인기 아티스트 섹션 -->
                    <div class="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl p-6 border border-purple-100">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold text-gray-800 flex items-center">
                                <i class="fas fa-star text-purple-500 mr-2"></i>
                                인기 아티스트
                            </h2>
                            ${data.popularArtists.length > 0 ? `
                                <a href="javascript:void(0)" onclick="goToPopularArtistsPage()" class="text-purple-600 hover:text-purple-700 text-sm font-medium flex items-center cursor-pointer">
                                    더보기 <i class="fas fa-arrow-right ml-1"></i>
                                </a>
                            ` : ''}
                        </div>
                        ${data.popularArtists.length > 0 ? `
                            <div class="space-y-3">
                                ${data.popularArtists.slice(0, 10).map((artist, index) => `
                                    <a href="/songs?q=${encodeURIComponent(artist.name)}" class="block">
                                        <div class="flex items-center space-x-3 p-4 bg-white rounded-lg hover:shadow-lg hover:scale-105 transition-all duration-200 cursor-pointer group">
                                            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-r from-purple-400 to-indigo-400 flex items-center justify-center text-white text-sm font-bold group-hover:from-purple-500 group-hover:to-indigo-500 transition-colors">
                                                ${index + 1}
                                            </div>
                                            <div class="flex-1 min-w-0">
                                                <p class="font-medium text-gray-800 truncate group-hover:text-purple-600 transition-colors">
                                                    ${artist.name}
                                                </p>
                                                <p class="text-xs text-gray-500 group-hover:text-gray-600 transition-colors">
                                                    ${artist.songs.length}곡 • <i class="fas fa-eye"></i> ${artist.totalViews.toLocaleString()}
                                                </p>
                                            </div>
                                        </div>
                                    </a>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="text-center py-8 text-gray-500">
                                <div class="text-6xl mb-3 opacity-50">🎭</div>
                                <p>아직 아티스트 데이터가 없습니다.</p>
                                <p class="text-sm">노래를 듣고 인기 아티스트를 확인해보세요!</p>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html> 